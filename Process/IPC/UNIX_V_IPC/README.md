## UNIX V / XSI IPC

#### Message Queue

	유닉스 시스템 V의 프로세스 간의 통신을 하기 위해 사용되는 메커니즘 중 하나 (쌍방향 통신)

	메일 시스템과 비슷한데, 입출력 data를 커널 내부에 메세지 리스트 형태로 저장해둔다!

		또한 커널 내부에 저장해두기 때문에 프로세스가 종료되어도 메세지가 사라지지 않는다.

			- 내부적으로 Queue의 자료구조를 갖기 때문에 메세지를 읽어 들인 후 삭제한다. 

	FIFO와 비슷하지만, 메세지가 중간에 저장되기 때문에 서버와 클라이언트들이 동일 시점에 데이터를 주고 받을 필요가 없다.


	메세지 큐는 msqid_ds 구조체를 사용하고, 키와 채널을 생성하기 위해 ipc 관련 header를 가져와야한다.

	->  <sys/msg.h> , <sys/ipc.h>

#### Semaphore (세마포어) 

	다중 프로그래밍 환경에서 임계 영역에 진입하여 공유 메모리와 같은 공유 자원에 대한 접근을 제한하는 방법으로 사용된다!

	세마포어는 식당의 자리 처럼, 다수의 자원을 놓고 경쟁하는 프로세스들 사이에서 필요한 동기화 기법이다.

	자원의 수를 기록하는 세마포어 변수 S와 P(감소) , V(증가) 연산을 이용해서 동기화한다.

	P 연산 : S를 1 감소 

	V 연산 : S를 1 증가 

	프로세는 S가 1 이상일 때만 임계 영역에 진입 가능 

		임계 영역 (Critical Section)

			공유자원에 접근할 수 있는 영역을 말한다. 반드시 보호되어야하는 구간으로
			
			보호하는 메커니즘으로 세마포어와 뮤텍스 등이 있다.

			Mutex와 Semaphore는 다음과 같은 차이가 있다.

				Mutex : lock, unlock 상태만 존재하는 일종의 Binary Semaphore
	
				Semaphore : 여러 프로세스가 동시에 공유 자원에 접근할 수도 있음


	세마포어를 사용하기 위해서는 공유 메모리에서 채널을 생성하는 것과 같이 세마포어를 위한 채널을 생성해야 한다.

		- semget() 함수로 수행 ( channel id return )

	세마포어를 증가 감소 시켜가며 프로세스의 접근을 제한 허용해야한다.

		- semop() 함수로 수행 (성공 시 0 , 실패 시 -1 return)

	세마포어를 설정할 때에는 sembuf 구조체를 사용한다.

		- sembuf 구조체의 sem_op 인자의 값이 0보다 클 때에는 세마포어 값을 sem_op만큼 증가(V 연산)시킨다.

		- sembuf 구조체의 sem_op 인자의 값이 0보다 작을 때는 세마포어 값을 sem_op만큼 감소(P 연산)시킨다.

	세마포어를 제어하거나 삭제

		- semctl() 함수로 수행 
		
	
#### 공유 메모리

	프로세스에서 메모리는 해당 프로세스만이 사용하는 게 일반적이다.

	메모리에는 명령어, 지역 변수, 동적 변수 와 같이 데이터가 존재하는데 해당 프로세스만 접근할 수 있고 변경 가능!

		하지만 이 메모리에 있는 데이터를 다른 프로세스가 사용할 수 있도록 할 수 있다.

		이것이 바로 공유 메모리 라는 IPC 기법이다.

	프로세스 간의 메모리를 공유하는 방식으로 통신하는 방법이다. 메모리 복사 횟수를 줄여서 성능 향상을 이끌 수 있다.

	하지만 여러 프로세스들이 동시에 같은 메모리 주소에 접근해서 값을 변경할 시 문제가 발생할 수 있으므로, 

	동기화 기법이 필요하다. ( 세마포어나 뮤텍스 등..)

![KakaoTalk_20210805_161046853](https://user-images.githubusercontent.com/59076451/128307241-7d600f92-e974-4c5a-ae57-7c0446eb27fd.jpg)

	

	Linux에서 공유 메모리를 위한 함수들을 제공한다.

	이 공유 메모리를 사용하기 위해선 공유 메모리에 대한 채널을 생성하거나 기존의 채널을 가져와야한다. 

		- shmget() 함수로 수행

	또한 공유 메모리 사용을 위해 현재 프로세스와 이 공유 메모리를 연결해야하고, 메로리의 시작 주소를 가져와야한다.

		- shmat() 함수로 수행 

	사용이 끝난 공유 메모리는 자원 반납을 위해 프로세스와 연결을 해제해야한다.

		- shmdt() 함수로 수행 

	연결된 채널의 제어나 해제를 위해서도 함수가 존재한다.

		- shmctl() 

#### Message Queue 실행결과

![qqq](https://user-images.githubusercontent.com/59076451/128169071-8b9e5f2d-3830-463f-8779-4237f8cc1065.PNG)



#### 세마포어 실행결과

![1111](https://user-images.githubusercontent.com/59076451/128306821-142a7b88-3c5c-4ac0-ac82-e31ed849d4f1.PNG)



#### 공유 메모리 실행결과




- 참고자료 

https://reakwon.tistory.com/97
